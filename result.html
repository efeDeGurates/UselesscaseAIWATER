<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AI Su TÃ¼ketimi â€” SonuÃ§</title>
  <link rel="stylesheet" href="result.css"/>
</head>
<body>
  <main class="container">
    <div class="card">
      <h1>ğŸ’§ HaftalÄ±k AI Su TÃ¼ketimin</h1>
      <div id="summary">HesaplanÄ±yor...</div>

      <div class="controls">
        <button id="backBtn" class="btn light">Geri</button>
        <button id="shareBtn" class="btn">PaylaÅŸÄ±labilir GÃ¶rsel Ä°ndir</button>
      </div>

      <canvas id="shareCanvas" style="display:none;"></canvas>
    </div>
  </main>

  <script>
    // katsayÄ±lar (litre / dakika)
    const RATES={
      text:0.025,
      image:0.060,
      code:0.035,
      audio:0.050,
      video:0.080,
      translate:0.015,
      data:0.030,
      chat:0.025
    };
    const labels={
      text:"Metin Ã¼retme",
      image:"GÃ¶rsel oluÅŸturma",
      code:"Kod yazma",
      audio:"Ses Ã¼retme",
      video:"Video oluÅŸturma",
      translate:"Ã‡eviri",
      data:"Veri analizi",
      chat:"Sohbet asistanÄ±"
    };

    const params=new URLSearchParams(window.location.search);
    const name=params.get("name")||"KullanÄ±cÄ±";

    let total=0;
    let details=[];
    Object.keys(RATES).forEach(k=>{
      const min=parseFloat(params.get(k+"_min")||0);
      if(min>0){
        const liters=(min*RATES[k]*7).toFixed(3);
        details.push({label:labels[k],minutes:min,liters:liters});
        total+=parseFloat(liters);
      }
    });

    const summary=document.getElementById("summary");
    if(details.length===0){
      summary.innerHTML="<p class='error'>HiÃ§ kullanÄ±m seÃ§ilmemiÅŸ. LÃ¼tfen geri dÃ¶n.</p>";
      document.getElementById("shareBtn").style.display="none";
    }else{
      let html=`<p><strong>${name}</strong>, haftalÄ±k su tÃ¼ketim hesaplaman:</p><ul>`;
      details.forEach(d=>{
        html+=`<li>${d.label}: ${d.minutes} dk/gÃ¼n â†’ <strong>${d.liters} L/hafta</strong></li>`;
      });
      html+="</ul>";
      html+=`<p><strong>Toplam: ${total.toFixed(3)} L/hafta</strong></p>`;
      summary.innerHTML=html;
    }

    document.getElementById("backBtn").addEventListener("click",()=>history.back());

    // PaylaÅŸÄ±labilir gÃ¶rsel oluÅŸturma
    document.getElementById("shareBtn").addEventListener("click",()=>{
      const canvas=document.getElementById("shareCanvas");
      const width=900,height=600;
      canvas.width=width; canvas.height=height;
      const ctx=canvas.getContext("2d");

      ctx.fillStyle="#f8fffe";
      ctx.fillRect(0,0,width,height);

      ctx.fillStyle="#004d40";
      ctx.font="28px Arial";
      ctx.fillText("ğŸ’§ HaftalÄ±k AI Su TÃ¼ketimi",32,56);

      ctx.font="20px Arial";
      ctx.fillStyle="#073b36";
      ctx.fillText(`${name} â€” Toplam: ${total.toFixed(3)} L/hafta`,32,96);

      ctx.font="18px Arial";
      ctx.fillStyle="#0f1724";
      let y=150;
      details.forEach(d=>{
        ctx.fillText(`${d.label}: ${d.minutes} dk/gÃ¼n â†’ ${d.liters} L/hafta`,32,y);
        y+=34;
      });

      ctx.font="16px Arial";
      ctx.fillStyle="#6b7280";

      const link=document.createElement("a");
      link.download="ai_water_consumption.png";
      link.href=canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
